<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>TeacherPro v4.6 - Ultimative Korrektur</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root {
            --bg-body: #f8f7f2;
            --bg-sidebar: #f4f1ea;
            --bg-card: #ffffff;
            --primary: #5c7a63; 
            --text-main: #2c3e50;
            --border: rgba(92, 122, 99, 0.2);
            --radius: 16px;
        }

        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg-body); color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Navigation */
        .sidebar { width: 250px; background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; }
        .nav-item { padding: 12px 15px; margin-bottom: 5px; border-radius: 12px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 10px; }
        .nav-item.active { background: var(--primary); color: white; }

        @media (max-width: 800px) {
            body { flex-direction: column; }
            .sidebar { width: 100%; height: 70px; flex-direction: row; order: 2; padding: 0 5px; border-right: none; border-top: 1px solid var(--border); justify-content: space-around; align-items: center; }
            .main { order: 1; height: calc(100vh - 70px); }
            .nav-item span { display: none; }
        }

        /* Hauptbereich */
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .header { height: 70px; padding: 0 25px; display: flex; align-items: center; border-bottom: 1px solid var(--border); background: #fff; }
        .content { flex: 1; padding: 20px; overflow-y: auto; }

        /* Cards */
        .card { background: var(--bg-card); border-radius: var(--radius); padding: 20px; border: 1px solid var(--border); box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* LOGIN OVERLAY */
        #auth-overlay { position: fixed; inset: 0; background: var(--bg-body); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: #fff; padding: 30px; border-radius: 20px; width: 300px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid var(--border); }
        
        input, textarea, select { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border); margin-bottom: 10px; font-size: 1rem; }
        button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; }

        /* WICHTIG: Grundzustand aller Seiten ist 'none' */
        .page-view { display: none; }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div class="auth-card">
            <h2 style="color:var(--primary)">TeacherPro</h2>
            <div id="reg-box"><input type="text" id="reg-name" placeholder="Name"></div>
            <input type="password" id="auth-pass" placeholder="Passwort">
            <button onclick="handleAuth()">Starten ðŸŒ¿</button>
        </div>
    </div>

    <nav class="sidebar">
        <h3 style="color:var(--primary); margin-bottom: 20px;">TP v4.6</h3>
        <div class="nav-item active" onclick="nav('dashboard', this)"><span>Dashboard</span></div>
        <div class="nav-item" onclick="nav('classes', this)"><span>Klassen</span></div>
        <div class="nav-item" onclick="nav('tools', this)"><span>Werkzeuge</span></div>
        <div style="flex:1"></div>
        <div class="nav-item" onclick="location.reload()" style="color:red"><span>Abmelden</span></div>
    </nav>

    <main class="main">
        <header class="header"><h2 id="view-title">Dashboard</h2></header>
        <div class="content">
            
            <div id="view-dashboard" class="page-view" style="display: block;">
                <div class="card">
                    <h3>Willkommen, <span id="u-name-display">...</span>!</h3>
                    <textarea id="note-field" style="height: 150px;" oninput="save()" placeholder="Notizen..."></textarea>
                </div>
            </div>

            <div id="view-classes" class="page-view">
                <div class="card">
                    <button onclick="addClass()">+ Neue Klasse</button>
                    <div id="class-list" style="margin-top:20px;"></div>
                </div>
            </div>

            <div id="view-tools" class="page-view">
                <div class="card">
                    <h3>Timer</h3>
                    <h1 id="timer-display" style="text-align:center;">25:00</h1>
                    <button onclick="startT(25)">Start 25m</button>
                </div>
            </div>

        </div>
    </main>

    <script>
        let db = { user: '', pass: '', notes: '', classes: [] };

        // LOGIN LOGIK
        window.onload = () => {
            const saved = localStorage.getItem('tp_final_fix');
            if(saved) {
                document.getElementById('reg-box').style.display = 'none';
            }
        };

        function handleAuth() {
            const saved = localStorage.getItem('tp_final_fix');
            const pass = document.getElementById('auth-pass').value;
            if(!saved) {
                const name = document.getElementById('reg-name').value;
                if(!name || !pass) return alert("Bitte Name und Passwort wÃ¤hlen!");
                db.user = name; db.pass = pass;
                save(); location.reload();
            } else {
                db = JSON.parse(saved);
                if(pass === db.pass) {
                    document.getElementById('auth-overlay').style.display = 'none';
                    document.getElementById('u-name-display').innerText = db.user;
                    document.getElementById('note-field').value = db.notes;
                    renderC();
                } else alert("Falsches Passwort!");
            }
        }

        // NAVIGATION LOGIK (REPARIERT)
        function nav(id, el) {
            // Alle Seiten auf 'none' setzen
            const views = document.getElementsByClassName('page-view');
            for (let i = 0; i < views.length; i++) {
                views[i].style.display = 'none';
            }
            // GewÃ¼nschte Seite auf 'block' setzen
            document.getElementById('view-' + id).style.display = 'block';

            // Nav-Buttons stylen
            const items = document.getElementsByClassName('nav-item');
            for (let i = 0; i < items.length; i++) {
                items[i].classList.remove('active');
            }
            el.classList.add('active');
            document.getElementById('view-title').innerText = id.toUpperCase();
        }

        function save() {
            db.notes = document.getElementById('note-field').value;
            localStorage.setItem('tp_final_fix', JSON.stringify(db));
        }

        function addClass() {
            const n = prompt("Klasse:");
            if(n) { db.classes.push(n); save(); renderC(); }
        }

        function renderC() {
            const l = document.getElementById('class-list');
            l.innerHTML = '';
            db.classes.forEach(c => l.innerHTML += `<div class='card'><b>${c}</b></div>`);
        }

        function startT(m) {
            let s = m * 60;
            const t = setInterval(() => {
                s--;
                let min = Math.floor(s/60), sec = s%60;
                document.getElementById('timer-display').innerText = `${min}:${sec<10?'0':''}${sec}`;
                if(s<=0) clearInterval(t);
            }, 1000);
        }
    </script>
</body>
</html>
